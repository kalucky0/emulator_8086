(()=>{"use strict";var t={d:(r,e)=>{for(var n in e)t.o(e,n)&&!t.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:e[n]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r)};t.d({},{J$:()=>d,YD:()=>k,yt:()=>A,Kz:()=>E});var r=function(t){return document.querySelector(t)},e=function(t){return document.querySelectorAll(t)};Number.prototype.toHex=function(){return this.toString(16)};var n=/[^0-9]+/g,a=/[^0-9a-fA-F]+/g,i="0000",l={"0000":"00"},s={"0000":"00"},u=function(t){return t=t.toLowerCase(),null==s[t]&&(s[t]="00"),s[t]},o=function(t){for(var r=0,e=0,i=(t=t.slice(1,-1)).split("+");e<i.length;e++){var l=i[e];if("bx"==l||"bp"==l||"si"==l||"di"==l||"disp"==l)r+=parseInt(k[l].value,16);else if("h"!=l[l.length-1]&&"H"!=l[l.length-1]){if(n.test(l))return l+" can't be used to adress memory";r+=parseInt(l)}else{if(l=l.slice(0,-1),a.test(l))return l+" can't be used to adress memory";r+=parseInt(l,16)}}return r.toHex().padStart(4,"0")},c=function(t,r){var e;if(t=t.substring(t.length-4).toLowerCase(),"h"!=r[r.length-1]&&"H"!=r[r.length-1]){if(n.test(r))return"Argument is incorrect value";e=(r=parseInt(r)).toHex()}else if(e=r.slice(0,-1),a.test(e))return"Argument is incorrect value";return(e=e.toUpperCase()).length<=2?(e=e.padStart(2,"0"),l[t]=e):e.length>2&&((e=e.padStart(4,"0")).length>4&&(e=e.substring(e.length-4)),l[(parseInt(t,16)+1).toHex().padStart(4,"0")]=e.slice(0,2),l[t]=e.substring(2,4)),d.value=t.toUpperCase(),A(t,l),!1},f=function(t){return t=t.toLowerCase(),null==l[t]&&(l[t]="00"),l[t]},h=function(t){return null==k[t]?null:"x"==t[1]||"p"==t[1]||"i"==t[1]?4:2},g=function(t,r){var e="",i=h(t);if(null===i)return null;if("h"!=r[r.length-1]&&"H"!=r[r.length-1]){if(n.test(r))return"Incorrect value";e=(r=parseInt(r)).toHex()}else if(e=r.slice(0,-1),a.test(e))return"Incorrect value";return e=(e=e.padStart(i,"0")).toUpperCase(),console.log(t,e),4==i&&e.length>4||2==i&&e.length>2?"Out of register bounds or incorrect argument":(2==i&&(k[t].value=e),4==i&&("x"==t[1]?(k[t[0].concat("h")].value=e.slice(0,2),k[t[0].concat("l")].value=e.substring(2,4)):k[t].value=e),null)},p=function(t){if(null==k[t])return null;if("x"==t[1]){var r=k[t[0].concat("h")].value,e=k[t[0].concat("l")].value;return r=r.padStart(2,"0"),e=e.padStart(2,"0"),r.concat(e).concat("h")}return 2==h(t)?k[t].value.padStart(2,"0").concat("h"):4==h(t)?k[t].value.padStart(4,"0").concat("h"):null},v=function(t){var r=t.toLowerCase().split(/(?<=^\S+)\s/);if(!r[1])return"no arguments given";r[1]=r[1].replace(/\s+/g,"");var e=r[1].split(",");switch(r[0]){case"mov":return function(t){if(2!=t.length)return"incorrect arguments";if(t[0].startsWith("["))return(r=o(t[0])).length>5?r:null==h(t[1])?c(r,t[1]):c(r,p(t[1]));if(t[1].startsWith("[")){var r;if((r=o(t[1])).length>5)return r;var e=h(t[0]);if(null==e)return"wrong register: "+t[0];if(2==e)return g(t[0],f(r)+"h");var n=f("".concat((parseInt(r,16)+1).toHex().padStart(4,"0")).concat(f(r),"h"));return g(t[0],n)}var a=h(t[0]),i=h(t[1]);return null==a?"wrong register: "+t[0]:null==i?g(t[0],t[1]):a==i?g(t[0],p(t[1])):"Registers size do not match"}(e);case"xchg":return function(t){if(2!=t.length)return"incorrect arguments";if(t[0].startsWith("[")){if((a=o(t[0])).length>5)return a;if(null==(i=h(t[1])))return"wrong register: "+t[1];var r,e=p(t[1]);if(2==i)r=g(t[1],f(a));else{var n="".concat(f((parseInt(a,16)+1).toHex().padStart(4,"0"))).concat(f(a),"h");r=g(t[1],n)}return r||c(a,e)}if(t[1].startsWith("[")){var a,i;if((a=o(t[1])).length>5)return a;if(null==(i=h(t[0])))return"wrong register: "+t[0];var l,s=p(t[1]);return 2==i?l=g(t[0],f(a)):(n="".concat(f((parseInt(a,16)+1).toHex().padStart(4,"0"))).concat(f(a),"h"),l=g(t[0],n)),l||c(a,s)}var u=h(t[0]),v=h(t[1]);if(null==u)return"wrong register: "+t[0];if(null==v)return"wrong register: "+t[1];if(u!=v)return"registers sizes do not match";var d=p(t[0]);return g(t[0],p(t[1]))||g(t[1],d)}(e);case"push":return function(t){var r,e,l=h(t);if(null==l)e=t;else{if(l<4)return"wrong register: "+t;e=(e=null!==(r=p(t))&&void 0!==r?r:"").toLowerCase()}var u=function(t,r){var e="";if(t=t.substring(t.length-4).toLowerCase(),"h"!=r[r.length-1]&&"H"!=r[r.length-1]){if(n.test(r))return"Argument is incorrect value";e=(r=parseInt(r)).toHex()}else if(e=r.slice(0,-1),a.test(e))return"Argument is incorrect value";return(e=e.toUpperCase()).length<=2?(e=e.padStart(2,"0"),s[t]=e):e.length>2&&((e=e.padStart(4,"0")).length>4&&(e=e.substring(e.length-4)),s[(parseInt(t,16)+1).toHex().padStart(4,"0")]=e.slice(0,2),s[t]=e.substring(2,4)),!1}(k.sp.value,e);if(u)return u;var o=parseInt(k.sp.value,16)+2,c=g("sp",o);if(c)return c;E(i,s)}(e[0]);case"pop":return function(t){var r=h(t);if(null==r||r<4)return"incorrect register: "+t;var e=parseInt(k.sp.value,16)-2;if(e<0)return"empty stack";var n=g("sp",e);if(n)return n;E(i,s);var a=k.sp.value,l="".concat(u((parseInt(a,16)+1).toHex().padStart(4,"0"))).concat(u(a));return l=l.toLowerCase(),g(t,l+"h")}(e[0]);default:return"wrong instruction"}},d=r("#memAddress"),m=(r("#stackAddress"),e("#memory .input")),b=e("#stack .input"),S=e(".mem-name"),w=e(".stack-name"),x=r("#cmd"),C=r("#execBtn"),I=r("#randomBtn"),L=r("#resetRegBtn"),H=r("#resetDataBtn"),y=r("#resetStackBtn"),k=(e(".reg-val input"),{ah:r("#ah"),al:r("#al"),bh:r("#bh"),bl:r("#bl"),ch:r("#ch"),cl:r("#cl"),dh:r("#dh"),dl:r("#dl"),ax:r("#al"),bx:r("#bl"),cx:r("#cl"),dx:r("#dl"),bp:r("#bp"),si:r("#si"),di:r("#di"),sp:r("#sp"),disp:r("#disp")});I.onclick=function(){return function(){for(var t in k)if("sp"!=t&&"h"!=t[1]&&"l"!=t[1]){var r=(e=0,65535,e=Math.ceil(e),Math.floor(Math.random()*(Math.floor(65535)-e))+e);g(t,r)}var e}()},L.onclick=function(){return function(){for(var t in k)"sp"!=t&&"h"!=t[1]&&"l"!=t[1]&&g(t,0)}()},H.onclick=function(){return function(){for(var t in l)l[t]="00";A("0000",l)}()},y.onclick=function(){return function(){for(var t in s)s[t]="00";g("sp",0),E(i="0000",s)}()},C.onclick=function(){var t=v(x.value);t&&alert(t)};var A=function(t,r){t=t.toLowerCase();var e=[];S.forEach((function(r,n){e[n]=0==n?t.slice(0,-1)+"0":(parseInt(e[n-1],16)+16).toString(16).padStart(4,"0"),r.innerHTML=e[n].length>4?"":e[n]})),m.forEach((function(n){var a=n,i="";"a"==a.id[1]?i=e[0]:"b"==a.id[1]?i=e[1]:"c"==a.id[1]?i=e[2]:"d"==a.id[1]&&(i=e[3]);var l=(i.slice(0,-1)+a.id[0]).toLowerCase();l.length>4?a.value="":(null==r[l]&&(r[l]="00"),a.value=r[l].toUpperCase(),t==l?a.classList.add("highlight"):a.classList.remove("highlight"),a.parentElement.id=l)}))},E=function(t,r){t=t.toLowerCase();var e=[];w.forEach((function(r,n){e[n]=0==n?t.slice(0,-1)+"0":(parseInt(e[n-1],16)+16).toString(16).padStart(4,"0"),r.innerHTML=e[n].length>4?"":e[n]})),b.forEach((function(t){var n=t,a="";"a"==n.id[2]?a=e[0]:"b"==n.id[2]?a=e[1]:"c"==n.id[2]?a=e[2]:"d"==n.id[2]&&(a=e[3]);var i=(a.slice(0,-1)+n.id[1]).toLowerCase();i.length>4?n.value="":(null==r[i]&&(r[i]="00"),n.value=r[i].toUpperCase(),n.parentElement.id="s"+i,k.sp.value.toLowerCase()==i?n.classList.add("highlight"):n.classList.remove("highlight"))}))}})();